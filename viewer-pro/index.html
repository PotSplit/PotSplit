<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>AeonSight Pro — Viewer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Inline favicon (prevents /favicon.ico 404) -->
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Cdefs%3E%3CradialGradient id='g'%3E%3Cstop offset='0' stop-color='%2300ffd1'/%3E%3Cstop offset='1' stop-color='%23ff58da'/%3E%3C/radialGradient%3E%3C/defs%3E%3Ccircle fill='url(%23g)' cx='32' cy='32' r='28'/%3E%3Ccircle fill='none' stroke='%2300ffd1' stroke-width='4' cx='32' cy='32' r='22'/%3E%3C/svg%3E">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="./styles.css">
  <!-- PWA basics -->
<meta name="theme-color" content="#0b0c10" />
<link rel="manifest" href="manifest.webmanifest" />

<!-- No-404 favicon: inline SVG -->
<link rel="icon" href='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64"><defs><linearGradient id="g" x1="0" x2="1" y1="0" y2="1"><stop offset="0" stop-color="%2300ffd1"/><stop offset="1" stop-color="%23125bff"/></linearGradient></defs><rect width="64" height="64" rx="12" fill="%230b0c10"/><path d="M18 44l14-24 14 24" stroke="url(%23g)" stroke-width="4" fill="none" stroke-linecap="round" stroke-linejoin="round"/></svg>' />
</head>
<body>
  <header class="topbar">
    <div class="brand">
      <div class="logo" aria-hidden="true"></div>
      <span class="title">AeonSight Pro</span>
    </div>
    <nav class="top-actions">
      <a href="/" class="btn subtle">Home</a>
      <a href="/shop/shop.html" class="btn subtle">Shop</a>
      <button id="toggleReader" class="btn">Reader Mode</button>
      <button id="toggleLens" class="btn">Invisible Lens</button>
      <button id="sleepBtn" class="btn">Sleep Guard</button>
    </nav>
  </header>

  <main class="layout">
    <!-- Library / Controls -->
    <aside class="sidebar">
      <div class="panel">
        <h3>Library</h3>
        <div class="controls">
          <label class="file-btn">
            <input type="file" id="fileInput" accept=".pdf,.epub,.txt,.html" multiple />
            <span>+ Add Files</span>
          </label>
          <button id="loadDemo" class="btn small">Load Sample EPUB</button>
          <button id="clearLib" class="btn small danger">Clear Library</button>
        </div>
        <ul id="libList" class="library"></ul>
        <div class="hint">Tip: drag & drop files here, or paste a data URL.</div>
      </div>

      <div class="panel">
        <h3>View</h3>
        <div class="rows">
          <div class="row">
            <button id="prevPage" class="btn small">◀ Prev</button>
            <button id="nextPage" class="btn small">Next ▶</button>
          </div>
          <div class="row">
            <button id="zoomOut" class="btn small">– Zoom</button>
            <button id="zoomIn" class="btn small">+ Zoom</button>
          </div>
          <label class="row">
            <span>FOV</span>
            <input id="fov" type="range" min="40" max="100" value="72" />
          </label>
          <label class="row">
            <span>Font %</span>
            <input id="fontPct" type="range" min="80" max="180" value="100" />
          </label>
          <label class="row">
            <span>Sleep (min)</span>
            <input id="sleepMins" type="number" min="1" max="120" value="10" />
          </label>
        </div>
      </div>

      <div class="panel">
        <h3>Security</h3>
        <label class="row" title="Safer default: EPUB scripts are blocked so the iframe sandbox stays strict (no DevTools warning). Enable only if a specific book needs JS.">
          <input id="allowScripts" type="checkbox" />
          <span>Allow EPUB scripts (less safe)</span>
        </label>
        <div class="hint">Disabling this removes <code>allow-scripts</code> or <code>allow-same-origin</code> overlap so the iframe can’t “escape” its sandbox.</div>
      </div>

      <div class="panel">
        <h3>Stats</h3>
        <div class="stats">
          <div><strong id="statName">–</strong></div>
          <div>Status: <span id="statStatus">Idle</span></div>
          <div>Progress: <span id="statProg">0%</span></div>
          <div>Page: <span id="statPage">–</span></div>
          <div>Session: <span id="statTime">0:00</span></div>
          <div>Words read (est): <span id="statWords">0</span></div>
        </div>
      </div>
    </aside>

    <!-- Stage -->
    <section class="stage">
      <div id="content" class="content" tabindex="0" aria-label="Reading area">
        <div class="empty">Drop a PDF/EPUB/TXT/HTML here or click “+ Add Files”.</div>
      </div>

      <!-- Invisible Lens overlay -->
      <div id="lens" class="lens" aria-hidden="true"></div>
    </section>
  </main>

  <footer class="foot">
    <div>© <span id="year"></span> PotSplit — AeonSight Pro</div>
    <div class="kbd">
      Shortcuts: ←/→ page • +/- zoom • R reader • I lens • F fullscreen • S sleep
    </div>
  </footer>

  <!-- Libs (no SRI to avoid your earlier integrity block) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <script src="https://unpkg.com/epubjs/dist/epub.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
  <script>
    if (window['pdfjsLib']) {
      pdfjsLib.GlobalWorkerOptions.workerSrc =
        "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js";
    }
  </script>
  <script src="./pro.js"></script>
  <script>document.getElementById('year').textContent = new Date().getFullYear();</script>
</body>
</html>
